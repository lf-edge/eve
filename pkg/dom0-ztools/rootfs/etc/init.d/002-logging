#!/bin/sh

if test -f /proc/vmcore; then
    # NOOP if dump-capture kernel
    exit 0;
fi

# Create EVE services cgroup for memlogd (v2 style)
# The cgroup structure is created by 010-eve-cgroup script
# We just need to ensure the memlogd cgroup exists
mkdir -p /sys/fs/cgroup/eve/services/memlogd

# Move current process to memlogd cgroup (v2 style)
echo $$ > /sys/fs/cgroup/eve/services/memlogd/cgroup.procs

/usr/bin/memlogd -daemonize -max-line-len 8192
