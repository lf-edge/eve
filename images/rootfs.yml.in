kernel:
  image: KERNEL_TAG
  cmdline: "rootdelay=3"
init:
  - linuxkit/init:144c9cee8aed9e30a16940f2bf1d3813883aceda
  - linuxkit/runc:d971bd4ffcfc92fec49d1b46757a2a1bb98d1a65
  - linuxkit/containerd:d445de33c7f08470187b068d247b1c0dea240f0a
  # pillar's logic rely on existence of getty and /etc/init.d/001-getty inside
  - linuxkit/getty:06f34bce0facea79161566d67345c3ea49965437
  - linuxkit/memlogd:9a1bb29abca6d739f4b22c3e637faf1898e14184
  - DOM0ZTOOLS_TAG
  - GRUB_TAG
  - FW_TAG
  - XEN_TAG
  - GPTTOOLS_TAG
  - KEXEC_TAG
onboot:
  - name: rngd
    image: RNGD_TAG
    command: ["/sbin/rngd", "-1"]
  - name: sysctl
    image: linuxkit/sysctl:a88a50c104d538b58da5e1441f6f0b4b738f76a6
    binds:
      - /etc/sysctl.d:/etc/sysctl.d
    capabilities:
      - CAP_SYS_ADMIN
      - CAP_NET_ADMIN
  - name: modprobe
    image: linuxkit/modprobe:v0.5
    command: ["/bin/sh", "-c", "modprobe -a nct6775 w83627hf_wdt hpwdt wlcore_sdio wl18xx br_netfilter dwc3 rk808 rk808-regulator smsc75xx cp210x nicvf tpm_tis_spi rtc_rx8010 os-em32x regmap-i2c gpio_pca953x leds_gpio leds_siemens_ipc127 upboard-fpga pinctrl-upboard leds-upboard xhci_tegra 2>/dev/null || :"]
  # If you change the order of storage-init don't forget to
  # change 003-installer in pkg/mkimage-raw-efi accordingly:
  # storage-init must follow installer
  - name: storage-init
    image: STORAGE_INIT_TAG
  # kdump goes strictly after storage-init
  - name: kdump
    image: KDUMP_TAG
  # If you change the order of pillar-onboot don't forget to
  # change /containers/onboot/005-pillar-onboot/lower in pkg/mkimage-raw-efi accordingly:
  # 005-pillar-onboot must follow the order number of pillar-onboot
  # onboot part of pillar to prepare services to start
  - name: pillar-onboot
    image: PILLAR_TAG
    command: ["/opt/zededa/bin/onboot.sh"]
  - name: apparmor
    image: APPARMOR_TAG
  # measure-config must be executed after any other container that changes 
  # /config. Let's keep it the latest
  - name: measure-config
    image: MEASURE_CONFIG_TAG
services:
  - name: newlogd
    image: NEWLOGD_TAG
    cgroupsPath: /eve/services/newlogd
    oomScoreAdj: -999
  - name: edgeview
    image: EDGEVIEW_TAG
    cgroupsPath: /eve/services/eve-edgeview
    oomScoreAdj: -800
  - name: debug
    image: DEBUG_TAG
    cgroupsPath: /eve/services/debug
    oomScoreAdj: -999
  - name: wwan
    image: WWAN_TAG
    cgroupsPath: /eve/services/wwan
    oomScoreAdj: -999
  - name: wlan
    image: WLAN_TAG
    cgroupsPath: /eve/services/wlan
    oomScoreAdj: -999
  - name: guacd
    image: GUACD_TAG
    cgroupsPath: /eve/services/guacd
    oomScoreAdj: -999
  - name: pillar
    image: PILLAR_TAG
    cgroupsPath: /eve/services/pillar
    oomScoreAdj: -999
  - name: vtpm
    image: VTPM_TAG
    cgroupsPath: /eve/services/vtpm
    oomScoreAdj: -999
  - name: watchdog
    image: WATCHDOG_TAG
    cgroupsPath: /eve/services/watchdog
    oomScoreAdj: -1000
  - name: xen-tools
    image: XENTOOLS_TAG
    cgroupsPath: /eve/services/xen-tools
    oomScoreAdj: -999
files:
  - path: /etc/eve-release
    source: eve_version
  - path: etc/linuxkit-eve-config.yml
    metadata: yaml
  - path: /etc/eve-hv-type
    contents: 'EVE_HV'
